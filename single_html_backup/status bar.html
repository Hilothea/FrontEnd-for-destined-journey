<!DOCTYPE html>
<html lang="zh-CN">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å†’é™©çŠ¶æ€</title>
  <style>
   /* å¯¼å…¥å¤–éƒ¨å­—ä½“ï¼Œç”¨äºè¥é€ å¥‡å¹»é£æ ¼ */
   @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Noto+Sans+SC:wght@400;500;700&display=swap');

   /* --- åŸºç¡€æ ·å¼ --- */
   body {
    font-family: 'Noto Sans SC', 'Merriweather', serif;
    background-color: #f5efe6;
    color: #4a3b31;
    margin: 0;
    padding: 15px;
    background-repeat: repeat;
    background-image: url('https://www.transparenttextures.com/patterns/handmade-paper.png');
    background-size: cover;
    background-attachment: fixed;
   }

   /* --- ä¸»å®¹å™¨æ ·å¼ --- */
   .status-scroll {
    border: 2px solid #785a4e;
    border-radius: 8px;
    padding: 20px;
    background-color: rgba(240, 230, 210, 0.85);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25), inset 0 0 10px rgba(0, 0, 0, 0.05);
    max-width: 900px;
    margin: auto;
    position: relative;
    overflow: hidden;
   }

   /* --- é¡¶éƒ¨ä¿¡æ¯æ¡† (æ—¶é—´å’Œåœ°ç‚¹) --- */
   .time-location-box {
    background-color: #e8ddcb;
    padding: 10px 15px;
    border-radius: 4px;
    margin-bottom: 15px;
    border: 1px solid #c6b8a5;
    text-align: left;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
   }
   .time-location-box:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
   }

   /* --- é€šç”¨æ•°å€¼æ ·å¼ --- */
   .value-main {
    font-weight: 500;
    font-family: 'Noto Sans SC', 'Courier New', monospace;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.15), 0 0 5px rgba(255, 255, 255, 0.3);
   }

   /* --- å“è´¨é¢œè‰² --- */
   .quality-mythic {
    color: #d32f2f;
    font-weight: bold;
   }
   .quality-legendary {
    color: #9E7121;
    font-weight: bold;
   }
   .quality-epic {
    color: #9C27B0;
    font-weight: bold;
   }
   .quality-rare {
    color: #193C96;
    font-weight: bold;
   }
   .quality-uncommon {
    color: #388E3C;
    font-weight: bold;
   }
   .quality-common {
    /* No special color, inherits default */
   }

   /* --- æŠ˜å é¢æ¿ (details/summary) åŸºç¡€æ ·å¼ --- */
   details.section,
   details.sub-section,
   details.task-entry,
   details.skill-entry,
   details.destiny-target,
   details.inventory-item-entry {
    margin-bottom: 6px;
    border: 1px solid #d3c5b3;
    border-radius: 4px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease-in-out;
   }
   details.section:hover,
   details.sub-section:hover,
   details.task-entry:hover,
   details.skill-entry:hover,
   details.destiny-target:hover,
   details.inventory-item-entry:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
   }

  /* --- æŠ˜å é¢æ¿æ ‡é¢˜ (summary) --- */
  details > summary {
  font-family: 'Cinzel', serif;
  font-weight: 700;
  color: #5d4037;
  background-color: #d7c8b6;
  padding: 4px 15px;
  cursor: pointer;
  list-style: none;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #c6b8a5;
  text-align: left;
  transition: background-color 0.2s ease, color 0.2s ease;
  }
   details > summary::-webkit-details-marker {
    display: none;
   }
   details > summary:hover {
    background-color: #cbb8a5;
    color: #4a3b31;
   }
   details[open] > summary {
    background-color: #bfa996;
    border-bottom-color: #a39281;
   }

   /* --- æŠ˜å é¢æ¿æ ‡é¢˜å·¦ä¾§çš„å‘å…‰æ˜Ÿæ˜Ÿå›¾æ ‡ --- */
   details > summary::before {
    content: 'âœ¦';
    font-size: 1.1em;
    color: #a39281;
    text-shadow: none;
    margin-right: 12px;
    flex-shrink: 0;
    transform-origin: center center;
    transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), color 0.4s ease, text-shadow 0.4s ease;
   }
   details[open] > summary::before {
    transform: rotate(360deg);
    color: #f7d75a;
    text-shadow: 0 0 3px rgba(255, 255, 255, 0.8), 0 0 6px #f7d75a, 0 0 10px #e5a50a;
   }

   /* --- æŠ˜å é¢æ¿å³ä¾§çš„æŠ˜å ç®­å¤´ --- */
   .arrow-toggle {
    transition: transform 0.2s ease-in-out;
    font-size: 0.8em;
    padding-left: 5px;
    margin-left: auto;
   }
   details[open] > summary .arrow-toggle {
    transform: rotate(90deg);
   }

   /* --- æŠ˜å é¢æ¿å†…å®¹åŒºåŸŸ --- */
   .section-content,
   .sub-section-content,
   .task-content,
   .skill-description,
   .destiny-target-content,
   .inventory-item-details {
    padding: 15px;
    background-color: rgba(253, 250, 245, 0.9);
    text-align: left;
    font-size: 0.9em;
    transition: background-color 0.2s ease, padding 0.2s ease, box-shadow 0.2s ease;
   }
   .skill-description,
   .passive-skill-item {
    padding-top: 5px;
    padding-bottom: 5px;
   }
   .inventory-item-details {
    padding: 10px 15px;
   }

   /* --- å†…å®¹åŒºåŸŸé€šç”¨æ ·å¼ --- */
   .property,
   .equipment-slot,
   .inventory-category,
   .currency-item {
    margin-bottom: 8px;
    line-height: 1.6;
   }
   .property-name,
   .equipment-slot p:first-child,
   .inventory-category p:first-child {
    font-weight: bold;
    color: #6a514d;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.08);
   }
   .equip-description,
   .passive-skill-description,
   .title-effect {
    font-size: 0.85em;
    font-style: italic;
    color: #7a655d;
    padding-left: 10px;
    margin-top: 2px;
   }
   .currency-item {
    padding-left: 15px;
   }

   /* --- è¿›åº¦æ¡æ ·å¼ --- */
   .progress-bar-container {
    background-color: #c8bbaf;
    border-radius: 9px;
    height: 18px;
    margin-top: 4px;
    margin-bottom: 8px;
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, 0.15);
    box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.2);
   }
   .progress-bar-value {
    height: 100%;
    width: 0%;
    transition: width 0.8s ease-out;
    border-radius: 9px;
    text-align: center;
    color: white;
    font-size: 0.7em;
    line-height: 18px;
    background-image: linear-gradient(to bottom, rgba(255,255,255,0.15), rgba(0,0,0,0.1));
    box-shadow: inset 0 -1px 3px rgba(0,0,0,0.1);
   }

   /* --- åˆ†éš”çº¿æ ·å¼ --- */
   .thin-divider {
    border: 0;
    margin: 10px 0;
    background: transparent url("data:image/svg+xml,%3Csvg width='100%25' height='1' viewBox='0 0 100 1' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='0' y1='0.5' x2='100' y2='0.5' stroke='%23B3A291' stroke-dasharray='3 3'/%3E%3C/svg%3E") repeat-x center;
    border-top: none;
    height: 1px;
   }

   /* --- ç‰¹å®šåŒºåŸŸå¾®è°ƒ --- */
   .bonds-skill-section {
    margin-top: 10px;
   }

   /* --- ç™»ç¥é•¿é˜¶ä¸“å±æ ·å¼ --- */
   .step-level-req {
    font-size: 0.8em;
    color: #7a655d;
    font-style: italic;
    margin-left: 15px;
   }
   .step-item {
     margin-bottom: 5px;
     line-height: 1.6;
   }
   .item-name {
     font-weight: bold;
     color: #6d4c41;
   }
   .item-desc {
     font-size: 0.9em;
     font-style: italic;
     color: #7a655d;
     margin-left: 20px;
     display: block; /* ç¡®ä¿æ¢è¡Œ */
   }
   .empty-slot {
     color: #9e9e9e;
     font-style: italic;
   }
   .god-tier-grid {
     display: grid;
     grid-template-columns: 1fr 1fr;
     gap: 20px;
   }
   /* æœªè§£é”çŠ¶æ€ */
   details.sub-section.locked > summary {
    background-color: #e8e4e0;
    color: #b5aaa2;
    cursor: not-allowed;
   }
   details.sub-section.locked > summary::before {
    content: 'ğŸ”’';
    color: #b5aaa2;
   }


   /* --- æ–°é—»ç‰ˆå—æ ‡é¢˜æ ·å¼ --- */
   .news-headline {
    font-weight: 700;
   }
   .news-gold-lion {
    font-family: 'Cinzel', serif;
    color: #b9892d;
   }
   .news-tavern {
    font-family: 'Merriweather', serif;
    color: #6d4c41;
   }
   .news-wonders {
    font-family: 'Merriweather', serif;
    font-style: italic;
    color: #5c6bc0;
   }
   .news-tea-party {
    font-family: 'Cinzel', serif;
    color: #c2185b;
   }

   /* --- éšè—å…ƒç´ çš„é€šç”¨ç±» --- */
   .hidden {
    display: none !important;
   }

   /* --- å³æ—¶çŠ¶æ€åˆ—è¡¨æ ·å¼ --- */
   .instant-status-item {
    margin-left: 15px;
    font-size: 0.9em;
    color: #4a3b31;
    line-height: 1.5;
    white-space: pre-wrap;
   }
   .instant-status-item span.status-name {
    font-weight: bold;
    color: #6a514d;
   }

   /* --- å¸ƒå±€ç½‘æ ¼ (Grid) --- */
   .status-grid {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 20px;
    align-items: start;
   }
   .status-grid-left,
   .status-grid-right {
    display: flex;
    flex-direction: column;
    gap: 8px;
   }
   .vertical-divider {
    width: 1px;
    background-color: #d3c5b3;
    align-self: stretch;
    margin: 0 5px;
    background: transparent url("data:image/svg+xml,%3Csvg width='1' height='100%25' viewBox='0 0 1 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='0.5' y1='0' x2='0.5' y2='100' stroke='%23D3C5B3' stroke-dasharray='3 3'/%3E%3C/svg%3E") repeat-y center;
   }

   /* --- äº¤äº’å…ƒç´  (æŒ‰é’®) --- */
   .action-button {
    background-color: #8d6e63;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 0.9em;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
   }
   .action-button:hover {
    background-color: #6d4c41;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transform: translateY(-2px);
   }
   .action-button:active {
    transform: translateY(1px);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
   }

   @media (max-width: 768px) {
    .status-grid {
     grid-template-columns: 1fr;
     gap: 10px;
    }
    .vertical-divider {
     display: none;
    }
    .status-grid-right {
     border-top: 1px solid #d3c5b3;
     padding-top: 10px;
    }
   }

   /* --- æŠ˜å æ æ ‡é¢˜ä¸­é—´çš„åŠ¨æ€ä¿¡æ¯æ ·å¼ --- */
   .summary-details {
    margin-left: auto; /* æ ¸å¿ƒï¼šå°†æ­¤å…ƒç´ æ¨åˆ°å³è¾¹ */
    padding-right: 15px; /* ä¸å³ä¾§ç®­å¤´ä¿æŒè·ç¦» */
    font-family: 'Noto Sans SC', 'Courier New', monospace; /* ä½¿ç”¨æ•°å€¼å­—ä½“ */
    font-weight: 500;
    font-size: 0.8em;
    color: #6a514d; /* ä½¿ç”¨æ¯”æ ‡é¢˜ç¨æµ…çš„é¢œè‰² */
    letter-spacing: 0.5px;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.05);
    align-self: center; /* å‚ç›´å±…ä¸­å¯¹é½ */
   }

/* ä¸ºè§’è‰²èƒŒåŒ…ä¸­çš„å•ä¸ªç‰©å“æ¡ç›®åˆ›å»ºäº†ç‹¬ç«‹çš„æ ·å¼è§„åˆ™ */
details.inventory-item-entry > summary {
  padding-top: 0.8px;
  padding-bottom: 0.8px;
  font-size: 0.9em;
}
  </style>
 </head>
 <body>
  <!-- ä¸»å®¹å™¨ -->
  <div class="status-scroll">
   <!-- æ—¶é—´å’Œåœ°ç‚¹ -->
   <div class="time-location-box">
    <p>â³ï¸ æ—¶é—´: <span id="world-time" class="value-main"></span></p>
    <p>ğŸ“ åœ°ç‚¹: <span id="world-location" class="value-main"></span></p>
   </div>

   <!-- ç™»ç¥é•¿é˜¶ -->
   <details class="section" id="ascension-section">
    <summary>â™¾ï¸ ç™»ç¥é•¿é˜¶ <span class="summary-details" id="ascension-summary-details"></span><span class="arrow-toggle">â–¼</span></summary>
    <div class="section-content">

     <!-- è¦ç´  -->
     <details class="sub-section" id="ascension-elements-details">
      <summary>è¦ç´  <span class="step-level-req">60çº§å¼€å¯</span><span class="arrow-toggle">â–¼</span></summary>
      <div class="sub-section-content">
       <div id="ascension-elements-list"></div>
       <p class="empty-slot hidden" id="no-elements-msg">ï¼ˆå°šæ— è¦ç´ ï¼‰</p>
      </div>
     </details>
     <!-- æƒèƒ½ -->
     <details class="sub-section" id="ascension-authority-details">
      <summary>æƒèƒ½ <span class="step-level-req">80çº§å¼€å¯</span><span class="arrow-toggle">â–¼</span></summary>
      <div class="sub-section-content">
       <div id="ascension-authority-list"></div>
       <p class="empty-slot hidden" id="no-authority-msg">ï¼ˆå°šæ— æƒèƒ½ï¼‰</p>
      </div>
     </details>
     <!-- æ³•åˆ™ -->
     <details class="sub-section" id="ascension-laws-details">
      <summary>æ³•åˆ™ <span class="step-level-req">90çº§å¼€å¯</span><span class="arrow-toggle">â–¼</span></summary>
      <div class="sub-section-content">
       <div id="ascension-laws-list"></div>
       <p class="empty-slot hidden" id="no-laws-msg">ï¼ˆå°šæ— æ³•åˆ™ï¼‰</p>
      </div>
     </details>
     <!-- ç¥ä½ / ç¥å›½ -->
     <details class="sub-section" id="ascension-divinity-details">
      <summary>ç¥ä½ / ç¥å›½ <span class="step-level-req">100çº§å¼€å¯</span><span class="arrow-toggle">â–¼</span></summary>
      <div class="sub-section-content">
       <div class="god-tier-grid">
         <div>
           <div class="step-item">
             <span class="item-name">ç¥ä½: </span>
             <span class="value-main" id="ascension-divinity-name"></span>
             <span class="empty-slot hidden" id="divinity-empty-slot">ï¼ˆå°šæœªç™»ä¸´ï¼‰</span>
           </div>
         </div>
         <div>
           <div class="step-item">
             <span class="item-name">ç¥å›½: </span>
             <span class="value-main" id="ascension-kingdom-name"></span>
             <span class="empty-slot hidden" id="kingdom-empty-slot">ï¼ˆå°šæœªå¼€è¾Ÿï¼‰</span>
           </div>
         </div>
       </div>
      </div>
     </details>
    </div>
   </details>


   <!-- å½“å‰ä»»åŠ¡ -->
   <details class="section" id="tasks-section">
    <summary>ğŸ“œ å½“å‰ä»»åŠ¡ <span class="summary-details" id="tasks-summary-details"></span><span class="arrow-toggle">â–¼</span></summary>
    <div class="section-content">
     <div id="tasks-list-container"></div>
     <p id="no-tasks-msg" class="hidden">ï¼ˆæš‚æ— ä»»åŠ¡ï¼‰</p>
    </div>
   </details>

   <!-- è§’è‰²ä¿¡æ¯ä¸çŠ¶æ€ -->
  <details class="section" id="character-status-section">
  <summary>ğŸ‘¤ è§’è‰²ä¿¡æ¯ä¸çŠ¶æ€ <span class="summary-details" id="character-status-summary-details"></span><span class="arrow-toggle">â–¼</span></summary>
  <div class="section-content">
    <!-- èµ„æºæ¡: HP, MP, SP, EXP -->
    <div class="property">
    <span class="property-name">â¤ï¸ HP:</span>
    <span id="char-hp" class="value-main"></span> / <span id="char-hp-max" class="value-main"></span>
    <div class="progress-bar-container"><div id="char-hp-bar" class="progress-bar-value"></div></div>
    </div>
    <div class="property">
    <span class="property-name">ğŸ”® MP:</span>
    <span id="char-mp" class="value-main"></span> / <span id="char-mp-max" class="value-main"></span>
    <div class="progress-bar-container"><div id="char-mp-bar" class="progress-bar-value"></div></div>
    </div>
    <div class="property">
    <span class="property-name">âš¡ SP:</span>
    <span id="char-sp" class="value-main"></span> / <span id="char-sp-max" class="value-main"></span>
    <div class="progress-bar-container"><div id="char-sp-bar" class="progress-bar-value"></div></div>
    </div>
    <div class="property">
    <span class="property-name">ç´¯è®¡ç»éªŒ:</span> <span id="char-exp" class="value-main"></span> /
    <span id="char-exp-needed" class="value-main"></span>
    <div class="progress-bar-container"><div id="char-exp-bar" class="progress-bar-value"></div></div>
    </div>
    <hr class="thin-divider" />
  <!-- çŠ¶æ€ç½‘æ ¼å¸ƒå±€ -->
  <div class="status-grid">
  <!-- å·¦ä¾§ï¼šæˆ˜åŠ›å±‚çº§ã€ç­‰çº§ã€ç§æ—ã€èº«ä»½ã€èŒä¸šã€çŠ¶æ€ã€ç§°å·ç­‰ -->
  <div class="status-grid-left">
   <p><span class="property-name">âšœï¸ æˆ˜åŠ›å±‚çº§:</span> <span id="char-power-level" class="value-main"></span></p>
   <p><span class="property-name">âœ¨ ç­‰çº§:</span> <span id="char-level" class="value-main"></span></p>
   <p><span class="property-name">ğŸ§¬ ç§æ—:</span> <span id="char-race" class="value-main"></span></p>
   <p><span class="property-name">ğŸ‘‘ èº«ä»½:</span> <span id="char-identity" class="value-main">(æš‚æ— )</span></p>
   <p><span class="property-name">âš–ï¸ èŒä¸š:</span> <span id="char-occupation" class="value-main">(æš‚æ— )</span></p>
   <hr class="thin-divider" />
   <p>
   <span class="property-name">ğŸ”¥ å†’é™©è€…ç­‰çº§:</span>
   <span id="char-adventurer-rank" class="value-main">(æœªè¯„çº§)</span>
   </p>
   <p><span class="property-name">ğŸ† ç§°å·:</span> <span id="char-title" class="value-main">(æ— )</span></p>
   <div class="title-effect">(<span id="char-title-effect" class="value-main">æ— </span>)</div>
  </div>
  <!-- åˆ†éš”çº¿ -->
  <div class="vertical-divider"></div>
  <!-- å³ä¾§ï¼šå±æ€§ç‚¹å’Œäº”ç»´å±æ€§ -->
  <div class="status-grid-right">
   <p><span class="property-name">å±æ€§ç‚¹ AP:</span> <span id="char-ap" class="value-main"></span></p>

   <!-- å±æ€§æ­£å¸¸æ˜¾ç¤ºå®¹å™¨ -->
   <div id="ap-display-container">
   <p><span class="property-name">ğŸ’ª åŠ›é‡ STR:</span> <span id="char-str-display" class="value-main"></span></p>
   <p><span class="property-name">ğŸ¤¸ æ•æ· AGI:</span> <span id="char-agi-display" class="value-main"></span></p>
   <p><span class="property-name">ğŸ‹ï¸ ä½“è´¨ CON:</span> <span id="char-con-display" class="value-main"></span></p>
   <p><span class="property-name">ğŸ§  æ™ºåŠ› INT:</span> <span id="char-int-display" class="value-main"></span></p>
   <p><span class="property-name">ğŸ§˜ ç²¾ç¥ SPI:</span> <span id="char-spi-display" class="value-main"></span></p>
   </div>

   <hr class="thin-divider" />
   <div class="property">
    <span class="property-name">ğŸ”˜ å³æ—¶çŠ¶æ€:</span>
    <div id="char-instant-status-container"></div>
    <p id="no-instant-status-msg" class="value-main">(æ­£å¸¸)</p>
   </div>
  </div>
  </div>
  </div>
  </details>

<details class="section" id="character-equipment-section">
<summary>âš”ï¸ è§’è‰²è£…å¤‡ <span class="arrow-toggle">â–¼</span></summary>
<div class="section-content">
  <div class="equipment-slot" id="equip-weapon-slot">
  <p>ğŸ—¡ï¸ ä¸»æ­¦å™¨: <span id="equip-weapon-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-weapon-desc-p">
    <span id="equip-weapon-desc" class="value-main"></span>
  </p>
  </div>
  <hr class="thin-divider" />
  <div class="equipment-slot" id="equip-offhand-slot">
  <p>ğŸ›¡ï¸ å‰¯æ­¦å™¨: <span id="equip-offhand-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-offhand-desc-p">
    <span id="equip-offhand-desc" class="value-main"></span>
  </p>
  </div>
  <hr class="thin-divider" />
  <div class="equipment-slot" id="equip-body-slot">
  <p>ğŸ§¥ èº«ä½“: <span id="equip-body-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-body-desc-p">
    <span id="equip-body-desc" class="value-main"></span>
  </p>
  </div>
  <hr class="thin-divider" />
  <div class="equipment-slot" id="equip-head-slot">
  <p>ğŸ“ å¤´éƒ¨é˜²å…·: <span id="equip-head-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-head-desc-p">
    <span id="equip-head-desc" class="value-main"></span>
  </p>
  </div>
  <hr class="thin-divider" />
  <div class="equipment-slot" id="equip-hands-slot">
  <p>ğŸ§¤ æ‰‹éƒ¨é˜²å…·: <span id="equip-hands-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-hands-desc-p">
    <span id="equip-hands-desc" class="value-main"></span>
  </p>
  </div>
  <hr class="thin-divider" />
  <div class="equipment-slot" id="equip-feet-slot">
  <p>ğŸ‘¢ è„šéƒ¨é˜²å…·: <span id="equip-feet-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-feet-desc-p">
    <span id="equip-feet-desc" class="value-main"></span>
  </p>
  </div>
  <hr class="thin-divider" />
  <div class="equipment-slot" id="equip-acc1-slot">
  <p>ğŸ’ é¥°å“1: <span id="equip-acc1-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-acc1-desc-p">
    <span id="equip-acc1-desc" class="value-main"></span>
  </p>
  </div>
  <hr class="thin-divider" />
  <div class="equipment-slot" id="equip-acc2-slot">
  <p>ğŸ“¿ é¥°å“2: <span id="equip-acc2-name" class="value-main">æ— è£…å¤‡</span></p>
  <p class="equip-description hidden" id="equip-acc2-desc-p">
    <span id="equip-acc2-desc" class="value-main"></span>
  </p>
  </div>
</div>
</details>

  <details class="section" id="character-skills-section">
  <summary>ğŸ’« è§’è‰²æŠ€èƒ½ <span class="arrow-toggle">â–¼</span></summary>
  <div class="section-content" id="skills-list">
    <details class="sub-section" id="character-passive-skills-section" open>
    <summary>ğŸ“Œ è¢«åŠ¨æŠ€èƒ½ <span class="arrow-toggle">â–¼</span></summary>
    <div class="sub-section-content" id="passive-skills-list-container"></div>
    <p id="no-passive-skills-msg" class="hidden">ï¼ˆå°šæœªæ‹¥æœ‰ä»»ä½•è¢«åŠ¨æŠ€èƒ½ï¼‰</p>
    </details>
    <hr class="thin-divider" />
    <details class="sub-section" id="character-active-skills-section" open>
    <summary>ğŸŒ€ ä¸»åŠ¨æŠ€èƒ½ <span class="arrow-toggle">â–¼</span></summary>
    <div class="sub-section-content" id="active-skills-list-container"></div>
    <p id="no-active-skills-msg" class="hidden">ï¼ˆå°šæœªä¹ å¾—ä»»ä½•ä¸»åŠ¨æŠ€èƒ½ï¼‰</p>
    </details>
  </div>
  </details>

   <!-- è§’è‰²èƒŒåŒ… -->
   <details class="section" id="character-inventory-section">
    <summary>ğŸ’ è§’è‰²èƒŒåŒ… <span class="summary-details"><span id="inventory-summary-details"></span><span id="inventory-item-count"></span></span><span class="arrow-toggle">â–¼</span></summary>
    <div class="section-content">
     <div class="inventory-category">
      <p>
    	<span class="property-name">ğŸ’° è´§å¸:</span>&nbsp;&nbsp;
    	<span class="currency-item">ğŸ’ <span id="currency-platinum" class="value-main">0</span></span>&nbsp;&nbsp;
    	<span class="currency-item">ğŸŸ¡<span id="currency-gold" class="value-main">0</span></span>&nbsp;&nbsp;
    	<span class="currency-item">âšª<span id="currency-silver" class="value-main">0</span></span>&nbsp;&nbsp;
    	<span class="currency-item">ğŸŸ¤<span id="currency-copper" class="value-main">0</span></span>
      </p>
     </div>
     <hr class="thin-divider" />
     <div class="inventory-category">
      <p class="property-name">ğŸ“¦ ç‰©å“åˆ—è¡¨:</p>
      <!-- Container for all sorted items -->
      <div id="inventory-all-items-container"></div>
      <p id="no-inventory-items-msg" class="hidden">ï¼ˆèƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿï¼‰</p>
     </div>
    </div>
   </details>

   <!-- å‘½è¿çº¢çº¿ -->
   <details class="section" id="destiny-section">
    <summary>ğŸ’ å‘½è¿çº¢çº¿ <span class="summary-details" id="destiny-summary-details"></span><span class="arrow-toggle">â–¼</span></summary>
    <div class="section-content">
     <button id="lilith-shop-btn" class="action-button">å‘½è¿æŠ½å¡(5è¿/500ç‚¹)</button>
     <p><span class="property-name">ğŸ’– å‘½è¿ç‚¹æ•° FP:</span> <span id="destiny-fp" class="value-main">0</span></p>
     <div id="destiny-targets-container"></div>
     <p id="no-destiny-targets-msg" class="hidden">ï¼ˆå°šæœªä¸ä»»ä½•äººç¼”ç»“æ·±åˆ»çš„å‘½è¿è”ç³»ï¼‰</p>
    </div>
   </details>

   <!-- æ¯æ—¥æ–°é—» -->
   <details class="section" id="news-section">
    <summary>ğŸŒ æ¯æ—¥æ–°é—»<span class="arrow-toggle">â–¼</span></summary>
    <div class="section-content">
     <button id="update-news-btn" class="action-button">æ›´æ–°æ¯æ—¥æ–°é—»</button>
     <details class="sub-section" id="news-gold-lion-section" open>
      <summary>
       <span class="news-headline news-gold-lion">ğŸŒ é˜¿æ–¯å¡”åˆ©äºšå¿«è®¯</span><span class="arrow-toggle">â–¼</span>
      </summary>
      <div class="sub-section-content">
       <p id="news-gold-lion-text">ï¼ˆæš‚æ— æœ€æ–°å¿«è®¯ï¼‰</p>
      </div>
     </details>
     <details class="sub-section" id="news-tavern-section" open>
      <summary>
       <span class="news-headline news-tavern">ğŸ» é…’é¦†ç•™è¨€æ¿</span><span class="arrow-toggle">â–¼</span>
      </summary>
      <div class="sub-section-content">
       <p id="news-tavern-text">ï¼ˆç•™è¨€æ¿ä¸Šç©ºç©ºå¦‚ä¹Ÿï¼‰</p>
      </div>
     </details>
     <details class="sub-section" id="news-tea-party-section" open>
      <summary>
       <span class="news-headline news-tea-party">â˜• çº¢çº¿åŠ©æ‰‹çš„åˆåèŒ¶ä¼š</span><span class="arrow-toggle">â–¼</span>
      </summary>
      <div class="sub-section-content">
       <p id="news-tea-party-text">ï¼ˆèŒ¶ä¼šä¸Šæ²¡ä»€ä¹ˆæ–°å…«å¦ï¼‰</p>
      </div>
     </details>
    </div>
   </details>
  </div>

  <script>
   // ====================================================================================
   //
   //                 ã€è„šæœ¬ä¸»é€»è¾‘ã€‘
   //
   // ====================================================================================

   // --- è¾…åŠ©å·¥å…·å‡½æ•° ---

   function getQualityClass(quality) {
    const qualityMap = {
     'ç¥è¯': 'quality-mythic',
     'ä¼ è¯´': 'quality-legendary',
     'å²è¯—': 'quality-epic',
     'ç¨€æœ‰': 'quality-rare',
     'ä¼˜è‰¯': 'quality-uncommon',
     'æ™®é€š': 'quality-common'
    };
    return qualityMap[quality] || 'quality-common';
   }

   function SafeGetValue(obj, path, defaultValue = '') {
    const keys = Array.isArray(path) ? path : path.split('.');
    let current = obj;
    for (let i = 0; i < keys.length; i++) {
     if (current === undefined || current === null || typeof current !== 'object' || !current.hasOwnProperty(keys[i])) {
      return defaultValue;
     }
     current = current[keys[i]];
    }
    if (current === undefined || current === null) return defaultValue;
    if (typeof defaultValue === 'object' && defaultValue !== null && typeof current === 'object') return current;
    if (Array.isArray(current)) {
     if (current.length > 0) {
      const actualValue = current[0];
      return typeof actualValue === 'boolean' ? actualValue : String(actualValue).trim();
     } else {
      return typeof defaultValue === 'string' ? String(defaultValue).trim() : defaultValue;
     }
    }
    if (typeof current === 'boolean') return current;
    return String(current).trim();
   }

   function updateProgressBar(barId, currentValue, maxValue, color = '#785A4E') {
    const progressBar = document.getElementById(barId);
    if (progressBar) {
     const current = parseFloat(currentValue) || 0;
     const max = parseFloat(maxValue) || 1; // é˜²æ­¢é™¤ä»¥0
     const percentage = Math.max(0, Math.min(100, (current / max) * 100));
     progressBar.style.width = `${percentage}%`;
     progressBar.style.backgroundColor = color;
    }
   }

   function setElementText(id, value, emptyValue = '') {
    const el = document.getElementById(id);
    if (el) {
     el.innerText = value === null || value === undefined || String(value).trim() === '' ? emptyValue : String(value).trim();
    }
   }

   function setElementHTML(id, value, emptyValue = '') {
    const el = document.getElementById(id);
    if (el) {
     const finalValue = value === null || value === undefined || String(value).trim() === '' ? emptyValue : String(value).trim();
     el.innerHTML = finalValue.replace(/\n/g, '<br />');
    }
   }

   function toggleElementVisibility(elementId, show) {
    const element = document.getElementById(elementId);
    if (element) {
     element.classList.toggle('hidden', !show);
    }
   }

   function setupCollapsibles() {
    document.querySelectorAll('details > summary').forEach(summary => {
     const arrow = summary.querySelector('.arrow-toggle');
     if (arrow && !summary.dataset.listenerAttached) {
      summary.dataset.listenerAttached = 'true';
      summary.addEventListener('click', function () {
       const detailsElement = this.parentElement;
       setTimeout(() => {
        const nowOpen = detailsElement.hasAttribute('open');
        arrow.style.transform = nowOpen ? 'rotate(90deg)' : '';
       }, 0);
      });
      if (summary.parentElement.hasAttribute('open')) {
       arrow.style.transform = 'rotate(90deg)';
      } else {
       arrow.style.transform = '';
      }
     }
    });
   }

   // --- æ•°æ®æ›´æ–°å‡½æ•° ---

   function updateWorldState(data) {
    setElementText('world-time', SafeGetValue(data, 'ä¸–ç•Œ.æ—¶é—´', 'æœªçŸ¥æ—¶é—´'));
    setElementText('world-location', SafeGetValue(data, 'ä¸–ç•Œ.åœ°ç‚¹', 'æœªçŸ¥åœ°ç‚¹'));
   }

   function updateAscensionLadder(data) {
    const ascensionData = SafeGetValue(data, 'ç™»ç¥é•¿é˜¶', {});
    const userLevel = parseInt(SafeGetValue(data, 'è§’è‰².çŠ¶æ€.ç­‰çº§', '1'), 10);
    const mainSection = document.getElementById('ascension-section');
    let summaryText;
    const createStepItemHTML = (name, desc) => `<div class="step-item"><span class="item-name">â– ${name}:</span><span class="item-desc">${desc}</span></div>`;

    const setupStep = (levelReq, detailsId) => {
      const detailsEl = document.getElementById(detailsId);
      if (userLevel < levelReq) {
        detailsEl.classList.add('locked');
        detailsEl.open = false;
      } else {
        detailsEl.classList.remove('locked');
      }
    };

    if (userLevel < 60) {
      summaryText = 'é•¿é˜¶æœªå¼€å¯';
      mainSection.classList.add('locked');
    } else {
      summaryText = 'é•¿é˜¶å·²å¯';
      mainSection.classList.remove('locked');
    }

    setupStep(60, 'ascension-elements-details');
    setupStep(80, 'ascension-authority-details');
    setupStep(90, 'ascension-laws-details');
    setupStep(100, 'ascension-divinity-details');

    const elementsList = document.getElementById('ascension-elements-list');
    let elementsHtml = '';
    let hasElements = false;
    if (userLevel >= 60) {
      const elementsArray = SafeGetValue(ascensionData, 'è¦ç´ ', []);
      const elementsObj = Array.isArray(elementsArray) && elementsArray.length > 0 ? elementsArray[0] : {};
      const elementKeys = Object.keys(elementsObj).filter(key => key !== '$meta' && SafeGetValue(elementsObj[key], 'åç§°'));
      if (elementKeys.length > 0) {
        hasElements = true;
        summaryText = 'å½“å‰é˜¶æ®µ: è¦ç´ ';
        elementKeys.forEach(key => elementsHtml += createStepItemHTML(SafeGetValue(elementsObj[key], 'åç§°'), SafeGetValue(elementsObj[key], 'æè¿°')));
      }
    }
    elementsList.innerHTML = elementsHtml;
    toggleElementVisibility('no-elements-msg', !hasElements);

    const authorityList = document.getElementById('ascension-authority-list');
    let authorityHtml = '';
    let hasAuthority = false;
    if (userLevel >= 80) {
      const authorityArray = SafeGetValue(ascensionData, 'æƒèƒ½', []);
      const authorityObj = Array.isArray(authorityArray) && authorityArray.length > 0 ? authorityArray[0] : {};
      const authorityKeys = Object.keys(authorityObj).filter(key => key !== '$meta' && SafeGetValue(authorityObj[key], 'åç§°'));
      if (authorityKeys.length > 0) {
        hasAuthority = true;
        summaryText = 'å½“å‰é˜¶æ®µ: æƒèƒ½';
        authorityKeys.forEach(key => authorityHtml += createStepItemHTML(SafeGetValue(authorityObj[key], 'åç§°'), SafeGetValue(authorityObj[key], 'æè¿°')));
      }
    }
    authorityList.innerHTML = authorityHtml;
    toggleElementVisibility('no-authority-msg', !hasAuthority);

    const lawsList = document.getElementById('ascension-laws-list');
    let lawsHtml = '';
    let hasLaws = false;
    if (userLevel >= 90) {
      const lawsArray = SafeGetValue(ascensionData, 'æ³•åˆ™', []);
      const lawsObj = Array.isArray(lawsArray) && lawsArray.length > 0 ? lawsArray[0] : {};
      const lawKeys = Object.keys(lawsObj).filter(key => key !== '$meta' && SafeGetValue(lawsObj[key], 'åç§°'));
      if (lawKeys.length > 0) {
        hasLaws = true;
        summaryText = 'å½“å‰é˜¶æ®µ: æ³•åˆ™';
        lawKeys.forEach(key => lawsHtml += createStepItemHTML(SafeGetValue(lawsObj[key], 'åç§°'), SafeGetValue(lawsObj[key], 'æè¿°')));
      }
    }
    lawsList.innerHTML = lawsHtml;
    toggleElementVisibility('no-laws-msg', !hasLaws);

    let divinityName = '', kingdomName = '';
    if (userLevel >= 100) {
      divinityName = SafeGetValue(ascensionData, 'ç¥ä½', '');
      kingdomName = SafeGetValue(ascensionData, 'ç¥å›½.åç§°', '');
      if (divinityName) {
        summaryText = `å·²ç™»ç¥: ${divinityName}`;
      }
    }
    setElementText('ascension-divinity-name', divinityName);
    toggleElementVisibility('divinity-empty-slot', !divinityName);
    setElementText('ascension-kingdom-name', kingdomName);
    toggleElementVisibility('kingdom-empty-slot', !kingdomName);

    setElementText('ascension-summary-details', summaryText);
   }

   function updateTasks(data) {
    const container = document.getElementById('tasks-list-container');
    const summaryDetails = document.getElementById('tasks-summary-details');
    const taskArray = SafeGetValue(data, 'ä»»åŠ¡åˆ—è¡¨', []);
    const taskList = Array.isArray(taskArray) && taskArray.length > 0 ? taskArray[0] : null;
    let tasksHtml = '';
    let taskCount = 0;

    if (taskList && typeof taskList === 'object') {
      const taskKeys = Object.keys(taskList).filter(key => key !== '$meta' && SafeGetValue(taskList[key], 'æ ‡é¢˜'));
      taskCount = taskKeys.length;

      if (taskCount > 0) {
        for (const taskKey of taskKeys) {
          const title = SafeGetValue(taskList[taskKey], 'æ ‡é¢˜');
          const intro = SafeGetValue(taskList[taskKey], 'ç®€ä»‹');
          const target = SafeGetValue(taskList[taskKey], 'ç›®æ ‡');
          const reward = SafeGetValue(taskList[taskKey], 'å¥–åŠ±');
          tasksHtml += `<details class="task-entry"><summary>ğŸš© <span class="value-main">${title}</span> <span class="arrow-toggle">â–¼</span></summary><div class="task-content"><p>ğŸ“– ç®€ä»‹: <span class="value-main">${intro}</span></p><p>ğŸ¯ ç›®æ ‡: <span class="value-main">${target}</span></p><p>ğŸ† å¥–åŠ±: <span class="value-main">${reward}</span></p></div></details>`;
        }
      }
    }

    container.innerHTML = tasksHtml;
    summaryDetails.textContent = `è¿›è¡Œä¸­: ${taskCount}ä¸ª`;
    toggleElementVisibility('no-tasks-msg', taskCount === 0);
   }

   function updateCharacterResources(data) {
    const resources = {
     hp: { current: 'è§’è‰².èµ„æº.ç”Ÿå‘½å€¼', max: 'è§’è‰².èµ„æº.ç”Ÿå‘½å€¼ä¸Šé™', bar: 'char-hp-bar', color: '#D32F2F' },
     mp: { current: 'è§’è‰².èµ„æº.æ³•åŠ›å€¼', max: 'è§’è‰².èµ„æº.æ³•åŠ›å€¼ä¸Šé™', bar: 'char-mp-bar', color: '#1976D2' },
     sp: { current: 'è§’è‰².èµ„æº.ä½“åŠ›å€¼', max: 'è§’è‰².èµ„æº.ä½“åŠ›å€¼ä¸Šé™', bar: 'char-sp-bar', color: '#388E3C' },
     exp: { current: 'è§’è‰².çŠ¶æ€.ç´¯è®¡ç»éªŒå€¼', max: 'è§’è‰².çŠ¶æ€.å‡çº§æ‰€éœ€ç»éªŒ', bar: 'char-exp-bar', color: '#FFA000' }
    };

    for (const [key, paths] of Object.entries(resources)) {
      const currentVal = SafeGetValue(data, paths.current, '0');
      const maxVal = SafeGetValue(data, paths.max, key === 'exp' ? '0' : '1');
      setElementText(`char-${key}`, currentVal);
      setElementText(`char-${key}-${key === 'exp' ? 'needed' : 'max'}`, maxVal);
      updateProgressBar(paths.bar, currentVal, maxVal, paths.color);
    }
   }

   function updateCharacterStatus(data) {
    setElementText('char-race', SafeGetValue(data, 'è§’è‰².ç§æ—', 'æœªçŸ¥'));
    setElementText('char-identity', SafeGetValue(data, 'è§’è‰².èº«ä»½', 'æš‚æ— '));
    setElementText('char-occupation', SafeGetValue(data, 'è§’è‰².èŒä¸š', 'æš‚æ— '));
    setElementText('char-power-level', SafeGetValue(data, 'è§’è‰².çŠ¶æ€.æˆ˜åŠ›å±‚çº§', 'ç¬¬ä¸€å±‚çº§/æ™®é€šå±‚çº§'));
    setElementText('char-level', SafeGetValue(data, 'è§’è‰².çŠ¶æ€.ç­‰çº§', '1'));
    setElementText('char-adventurer-rank', SafeGetValue(data, 'è§’è‰².çŠ¶æ€.å†’é™©è€…ç­‰çº§', 'æœªè¯„çº§'));
    setElementText('char-title', SafeGetValue(data, 'è§’è‰².çŠ¶æ€.ç§°å·', 'æ— '));
    setElementText('char-title-effect', SafeGetValue(data, 'è§’è‰².çŠ¶æ€.ç§°å·æ•ˆæœ', 'æ— '));

    const statusContainer = document.getElementById('char-instant-status-container');
    const statusArray = SafeGetValue(data, 'è§’è‰².çŠ¶æ€.å³æ—¶çŠ¶æ€', []);
    const statusObj = Array.isArray(statusArray) && statusArray.length > 0 ? statusArray[0] : {};
    let statusHtml = '';
    let hasStatus = false;

    if (statusObj && typeof statusObj === 'object') {
      const statusKeys = Object.keys(statusObj).filter(key => key !== '$meta' && (SafeGetValue(statusObj[key], 'åç§°') || SafeGetValue(statusObj[key], 'æ•ˆæœ')));
      if (statusKeys.length > 0) {
        hasStatus = true;
        for (const key of statusKeys) {
          const statusData = statusObj[key];
          const name = SafeGetValue(statusData, 'åç§°', key);
          const effect = SafeGetValue(statusData, 'æ•ˆæœ');
          const duration = SafeGetValue(statusData, 'æŒç»­');
          let text = `<span class="status-name">${name}</span>`;
          if (effect) text += `: ${effect}`;
          if (duration) text += ` (${duration})`;
          statusHtml += `<p class="instant-status-item">- ${text}</p>`;
        }
      }
    }
    statusContainer.innerHTML = statusHtml;
    toggleElementVisibility('no-instant-status-msg', !hasStatus);
   }

   function updateCharacterAttributes(data) {
    const ap = parseInt(SafeGetValue(data, 'è§’è‰².å±æ€§.å±æ€§ç‚¹', '0'), 10);
    setElementText('char-ap', ap);

    const stats = {
      str: 'è§’è‰².å±æ€§.åŠ›é‡', agi: 'è§’è‰².å±æ€§.æ•æ·', con: 'è§’è‰².å±æ€§.ä½“è´¨',
      int: 'è§’è‰².å±æ€§.æ™ºåŠ›', spi: 'è§’è‰².å±æ€§.ç²¾ç¥'
    };

    for (const [key, path] of Object.entries(stats)) {
     const value = SafeGetValue(data, path, '0');
     setElementText(`char-${key}-display`, value);
    }
   }

   function updateSkills(data) {
    const rarityOrder = { 'ç¥è¯': 6, 'ä¼ è¯´': 5, 'å²è¯—': 4, 'ç¨€æœ‰': 3, 'ä¼˜è‰¯': 2, 'æ™®é€š': 1 };
    let passiveSkills = [];
    let activeSkills = [];

    const skillListContainer = SafeGetValue(data, 'æŠ€èƒ½åˆ—è¡¨', []);
    const skillList = Array.isArray(skillListContainer) && skillListContainer.length > 0 ? skillListContainer[0] : null;
    if (skillList && typeof skillList === 'object') {
      const skillKeys = Object.keys(skillList).filter(key => key !== '$meta' && SafeGetValue(skillList[key], 'åç§°'));

      for (const key of skillKeys) {
        const skill = skillList[key];
        const skillData = {
          name: SafeGetValue(skill, 'åç§°'),
          quality: SafeGetValue(skill, 'å“è´¨'),
          cost: SafeGetValue(skill, 'æ¶ˆè€—', ''),
          desc: SafeGetValue(skill, 'æè¿°'),
          type: SafeGetValue(skill, 'ç±»å‹')
        };
        if (skillData.type === 'è¢«åŠ¨') {
          passiveSkills.push(skillData);
        } else if (skillData.type === 'ä¸»åŠ¨') {
          activeSkills.push(skillData);
        }
      }
    }

    const sortByRarity = (a, b) => (rarityOrder[b.quality] || 0) - (rarityOrder[a.quality] || 0);
    passiveSkills.sort(sortByRarity);
    activeSkills.sort(sortByRarity);

    const createPassiveSkillHtml = (skill) => {
     const qualityClass = getQualityClass(skill.quality);
     const displayNameHTML = `<span class="${qualityClass}">${skill.name}${skill.quality ? `(${skill.quality})` : ''}</span>`;
     return `<details class="skill-entry"><summary><span class="value-main">${displayNameHTML}</span> <span class="arrow-toggle">â–¼</span></summary><div class="skill-description">${skill.desc}</div></details>`;
    };
    const createActiveSkillHtml = (skill) => {
     const qualityClass = getQualityClass(skill.quality);
     const displayNameHTML = `<span class="${qualityClass}">${skill.name}${skill.quality ? `(${skill.quality})` : ''}</span>`;
     const titleHTML = skill.cost ? `${displayNameHTML} | ${skill.cost}` : displayNameHTML;
     return `<details class="skill-entry"><summary><span class="value-main">${titleHTML}</span> <span class="arrow-toggle">â–¼</span></summary><div class="skill-description">${skill.desc}</div></details>`;
    };

    const passiveHtml = passiveSkills.map(createPassiveSkillHtml).join('');
    const activeHtml = activeSkills.map(createActiveSkillHtml).join('');

    document.getElementById('passive-skills-list-container').innerHTML = passiveHtml;
    document.getElementById('active-skills-list-container').innerHTML = activeHtml;
    toggleElementVisibility('no-passive-skills-msg', passiveSkills.length === 0);
    toggleElementVisibility('no-active-skills-msg', activeSkills.length === 0);
   }

   function updateEquipment(data) {
     const equipSlots = {
       weapon: 'ä¸»æ­¦å™¨', offhand: 'å‰¯æ­¦å™¨', hands: 'æ‰‹éƒ¨é˜²å…·', head: 'å¤´éƒ¨é˜²å…·',
       'body': 'èº«ä½“é˜²å…·', feet: 'è„šéƒ¨é˜²å…·',
       acc1: 'é¥°å“1', acc2: 'é¥°å“2'
     };
     const equipData = SafeGetValue(data, 'è´¢äº§.è£…å¤‡', {});

     for (const [slot, key] of Object.entries(equipSlots)) {
       const name = SafeGetValue(equipData, `${key}.åç§°`, 'æ— è£…å¤‡');
       const quality = SafeGetValue(equipData, `${key}.å“è´¨`);
       const desc = SafeGetValue(equipData, `${key}.æè¿°`);

       let displayNameHTML;
       if (name !== 'æ— è£…å¤‡') {
           const qualityClass = getQualityClass(quality);
           displayNameHTML = `<span class="${qualityClass}">${name}${quality ? `(${quality})` : ''}</span>`;
       } else {
           displayNameHTML = 'æ— è£…å¤‡';
       }

       const nameElement = document.getElementById(`equip-${slot}-name`);
       if (nameElement) {
           nameElement.innerHTML = displayNameHTML;
       }

       const hasDesc = desc && name !== 'æ— è£…å¤‡';
       if (hasDesc) {
         setElementText(`equip-${slot}-desc`, desc);
       }
       toggleElementVisibility(`equip-${slot}-desc-p`, hasDesc);
     }
   }

   function updateInventory(data) {
    // è´§å¸
    const currencyData = SafeGetValue(data, 'è´¢äº§.è´§å¸', {});
    const platinum = SafeGetValue(currencyData, 'ç™½é‡‘å¸', '0');
    const gold = SafeGetValue(currencyData, 'é‡‘å¸', '0');
    const silver = SafeGetValue(currencyData, 'é“¶å¸', '0');
    const copper = SafeGetValue(currencyData, 'é“œå¸', '0');
    const currencySummaryText = `ç™½é‡‘å¸: ${platinum} | é‡‘å¸: ${gold} | é“¶å¸: ${silver} | é“œå¸: ${copper}`;
    setElementText('inventory-summary-details', currencySummaryText); // æ›´æ–°è´§å¸æ‘˜è¦
    setElementText('currency-platinum', platinum);
    setElementText('currency-gold', gold);
    setElementText('currency-silver', silver);
    setElementText('currency-copper', copper);

    // ç‰©å“
    const rarityOrder = { 'ç¥è¯': 6, 'ä¼ è¯´': 5, 'å²è¯—': 4, 'ç¨€æœ‰': 3, 'ä¼˜è‰¯': 2, 'æ™®é€š': 1 };
    const typeOrder = { 'æ­¦å™¨é˜²å…·': 4, 'å…¶å®ƒç‰©å“': 3, 'æ¶ˆè€—å“': 2, 'ææ–™': 1 };
    let allItems = [];
    const inventoryArray = SafeGetValue(data, 'è´¢äº§.èƒŒåŒ…', []);
    const inventoryObject = Array.isArray(inventoryArray) && inventoryArray.length > 0 ? inventoryArray[0] : null;
    let itemCount = 0; // åˆå§‹åŒ–ç‰©å“ç§ç±»è®¡æ•°å™¨
    if (inventoryObject && typeof inventoryObject === 'object') {
     const itemKeys = Object.keys(inventoryObject).filter(key => key !== '$meta' && SafeGetValue(inventoryObject[key], 'é“å…·å'));
     itemCount = itemKeys.length; // è·å–ç‰©å“ç§ç±»æ•°é‡
     for (const key of itemKeys) {
      const item = inventoryObject[key];
      const itemData = {
       name: SafeGetValue(item, 'é“å…·å'),
       quality: SafeGetValue(item, 'å“è´¨'),
       qty: SafeGetValue(item, 'æ•°é‡', '1'),
       type: SafeGetValue(item, 'ç±»å‹', 'å…¶å®ƒç‰©å“'),
       desc: SafeGetValue(item, 'æè¿°', 'æ— ')
      };
      if (!typeOrder.hasOwnProperty(itemData.type)) {
       itemData.type = 'å…¶å®ƒç‰©å“';
      }
      allItems.push(itemData);
     }
    }
    
    const itemCountSummaryText = ` | ç‰©å“: ${itemCount}ç§`;
    setElementText('inventory-item-count', itemCountSummaryText);
    allItems.sort((a, b) => {
     const typeValueA = typeOrder[a.type] || 0;
     const typeValueB = typeOrder[b.type] || 0;
     if (typeValueA !== typeValueB) {
      return typeValueB - typeValueA;
     }
     const rarityValueA = rarityOrder[a.quality] || 0;
     const rarityValueB = rarityOrder[b.quality] || 0;
     return rarityValueB - rarityValueA;
    });
    const createItemHtml = (item) => {
     const qualityClass = getQualityClass(item.quality);
     const displayNameHTML = `<span class="${qualityClass}">${item.name}${item.quality ? `(${item.quality})` : ''}</span>`;
     return `<details class="inventory-item-entry"><summary><span class="value-main">${displayNameHTML} | ${item.qty}</span><span class="arrow-toggle">â–¼</span></summary><div class="inventory-item-details"><p><span class="property-name">ç±»å‹:</span> ${item.type}</p><p><span class="property-name">æè¿°:</span> ${item.desc}</p></div></details>`;
    };
    
    const allItemsHtml = allItems.map(createItemHtml).join('');
    document.getElementById('inventory-all-items-container').innerHTML = allItemsHtml;
    toggleElementVisibility('no-inventory-items-msg', allItems.length === 0);
   }

   function updateDestinySystem(data) {
    const destinyData = SafeGetValue(data, 'å‘½è¿ç³»ç»Ÿ', {});
    const fp = SafeGetValue(destinyData, 'å‘½è¿ç‚¹æ•°', '0');
    setElementText('destiny-fp', fp);

    const container = document.getElementById('destiny-targets-container');
    const summaryDetails = document.getElementById('destiny-summary-details');
    const destinyArray = SafeGetValue(destinyData, 'çº¢çº¿å¯¹è±¡', []);
    const destinyObject = Array.isArray(destinyArray) && destinyArray.length > 0 ? destinyArray[0] : null;
    let destinyHtml = '';
    const affectionBarsToUpdate = [];
    let characterCount = 0;

    if (destinyObject && typeof destinyObject === 'object') {
      const characterKeys = Object.keys(destinyObject).filter(key => key !== '$meta' && SafeGetValue(destinyObject[key], 'åç§°'));
      characterCount = characterKeys.length;

      if (characterCount > 0) {
        for (const key of characterKeys) {
          const char = destinyObject[key];
          const barId = `destiny-target-${key.replace(/\s+/g, '-')}-affection-bar`;
          destinyHtml += createDestinyTargetHTML(char, key, barId);
          const affectionRaw = SafeGetValue(char, 'å¥½æ„Ÿåº¦', '0/1000');
          const [current, max] = String(affectionRaw).split(' ')[0].split('/').map(Number);
          affectionBarsToUpdate.push({ barId, current, max: max || 1000 });
        }
      }
    }

    container.innerHTML = destinyHtml;
    summaryDetails.textContent = `FP: ${fp} | çº¢çº¿: ${characterCount}äºº`;
    toggleElementVisibility('no-destiny-targets-msg', characterCount === 0);
    affectionBarsToUpdate.forEach(bar => updateProgressBar(bar.barId, bar.current, bar.max, '#EC407A'));
   }

   function createDestinyTargetHTML(character, charKey, barId) {
    const name = SafeGetValue(character, 'åç§°');
    const powerLevel = SafeGetValue(character, 'æˆ˜åŠ›å±‚çº§');
    const level = SafeGetValue(character, 'ç­‰çº§');
    const race = SafeGetValue(character, 'ç§æ—');
    const identity = SafeGetValue(character, 'èº«ä»½');
    const occupation = SafeGetValue(character, 'èŒä¸š');
    const personality = SafeGetValue(character, 'æ€§æ ¼');
    const favorites = SafeGetValue(character, 'å–œçˆ±');
    const appearance = SafeGetValue(character, 'å¤–è²Œç‰¹è´¨');
    const adornments = SafeGetValue(character, 'è¡£ç‰©è£…é¥°');
    const equipment = SafeGetValue(character, 'è§’è‰²è£…å¤‡');
    const ascension = SafeGetValue(character, 'ç™»ç¥é•¿é˜¶');
    const isTied = SafeGetValue(character, 'æ˜¯å¦ç¼”ç»“çº¢çº¿', 'å¦');
    const affectionText = String(SafeGetValue(character, 'å¥½æ„Ÿåº¦', '0/1000')).split(' ')[0];
    const evalText = SafeGetValue(character, 'è¯„ä»·');
    const backstory = SafeGetValue(character, 'èƒŒæ™¯æ•…äº‹');
    const bondSkillText = SafeGetValue(character, 'ç¾ç»ŠæŠ€èƒ½');

    const powerLevelHTML = `<p><span class="property-name">âšœï¸ æˆ˜åŠ›å±‚çº§:</span> <span class="value-main">${powerLevel || 'æœªçŸ¥'}</span></p>`;
    const levelHTML = `<p><span class="property-name">âœ¨ ç­‰çº§:</span> <span class="value-main">${level || 'æœªçŸ¥'}</span></p>`;
    const raceHTML = `<p><span class="property-name">ğŸ§¬ ç§æ—:</span> <span class="value-main">${race || 'æœªçŸ¥'}</span></p>`;
    const identityHTML = `<p><span class="property-name">ğŸ‘‘ èº«ä»½:</span> <span class="value-main">${identity || 'æœªçŸ¥'}</span></p>`;
    const occupationHTML = `<p><span class="property-name">âš–ï¸ èŒä¸š:</span> <span class="value-main">${occupation || 'æœªçŸ¥'}</span></p>`;
    const personalityHTML = `<p><span class="property-name">ğŸ­ æ€§æ ¼:</span> <span class="value-main">${personality || 'æœªçŸ¥'}</span></p>`;
    const favoritesHTML = `<p><span class="property-name">ğŸ’– å–œçˆ±:</span> <span class="value-main">${favorites || 'æœªçŸ¥'}</span></p>`;
    const appearanceHTML = `<p><span class="property-name">ğŸŒ¸ å¤–è²Œç‰¹è´¨:</span> <span class="value-main">${appearance || 'æœªçŸ¥'}</span></p>`;
    const adornmentsHTML = `<p><span class="property-name">ğŸ‘— è¡£ç‰©è£…é¥°:</span> <span class="value-main">${adornments || 'æœªçŸ¥'}</span></p>`;
    const equipmentHTML = `<p><span class="property-name">âš”ï¸ è§’è‰²è£…å¤‡:</span> <span class="value-main">${equipment || 'æœªçŸ¥'}</span></p>`;
    const ascensionHTML = `<p><span class="property-name">â™¾ï¸ç™»ç¥é•¿é˜¶:</span> <span class="value-main">${ascension || 'æœªå¼€å¯'}</span></p>`;
    const backstoryHTML = `<p><span class="property-name">ğŸ“œèƒŒæ™¯æ•…äº‹:</span> <span class="value-main">${backstory || 'æœªçŸ¥'}</span></p>`;

    const detailsDividerHTML = '<hr class="thin-divider">';

    let bondSkillHTML = '';
    if (isTied === 'æ˜¯') {
      if (bondSkillText && bondSkillText.trim() !== '') {
        const formattedBondSkills = bondSkillText.split('\n').map(line => line.trim()).filter(line => line !== '').join('<br>');
        bondSkillHTML = `<p class="value-main">${formattedBondSkills}</p>`;
      } else {
        bondSkillHTML = '<p class="value-main">ï¼ˆå°šæœªè§‰é†’ï¼‰</p>';
      }
    } else {
      bondSkillHTML = '<p class="value-main">ï¼ˆæ— ç¾ç»ŠæŠ€èƒ½ï¼‰</p>';
    }

    return `
     <details class="destiny-target" id="destiny-target-${charKey.replace(/\s+/g, '-')}-details">
      <summary><span class="value-main">${name}</span> <span class="arrow-toggle">â–¼</span></summary>
      <div class="destiny-target-content">
       ${powerLevelHTML}
       ${levelHTML}
       ${raceHTML}
       ${identityHTML}
       ${occupationHTML}
       ${personalityHTML}
       ${favoritesHTML}
       ${appearanceHTML}
       ${adornmentsHTML}
       ${equipmentHTML}
       ${ascensionHTML}

       ${detailsDividerHTML}
       <p><span class="property-name">æ˜¯å¦ç¼”ç»“çº¢çº¿:</span> <span class="value-main">${isTied}</span></p>
       <p><span class="property-name">â¤ï¸ å¥½æ„Ÿåº¦:</span> <span class="value-main">${affectionText}</span></p>
       <div class="progress-bar-container"><div id="${barId}" class="progress-bar-value"></div></div>
       <p><span class="property-name">ğŸ’­ è¯„ä»·:</span> <span class="value-main">${evalText || 'ï¼ˆæš‚æ— è¯„ä»·ï¼‰'}</span></p>
       ${backstoryHTML}
       <hr class="thin-divider">
       <details class="sub-section bonds-skill-section">
        <summary>ğŸ’ ç¾ç»ŠæŠ€èƒ½ <span class="arrow-toggle">â–¼</span></summary>
        <div class="sub-section-content">${bondSkillHTML}</div>
       </details>
      </div>
     </details>`;
   }

   function updateNews(data) {
    const newsData = SafeGetValue(data, 'æ¯æ—¥æ–°é—»', {});
    const newsFields = {
     'news-gold-lion-text': { key: 'é˜¿æ–¯å¡”åˆ©äºšå¿«è®¯', empty: 'ï¼ˆæš‚æ— æœ€æ–°å¿«è®¯ï¼‰' },
     'news-tavern-text': { key: 'é…’é¦†ç•™è¨€æ¿', empty: 'ï¼ˆç•™è¨€æ¿ä¸Šç©ºç©ºå¦‚ä¹Ÿï¼‰' },
     'news-tea-party-text': { key: 'çº¢çº¿åŠ©æ‰‹çš„åˆåèŒ¶ä¼š', empty: 'ï¼ˆèŒ¶ä¼šä¸Šæ²¡ä»€ä¹ˆæ–°å…«å¦ï¼‰' }
    };
    for (const [elementId, info] of Object.entries(newsFields)) {
     let rawValue = SafeGetValue(newsData, info.key, '');
     let formattedValue = rawValue.replace(/\|/g, '\n');
     setElementHTML(elementId, formattedValue, info.empty);
    }
   }

  function updateAllSummaryDetails(data) {
   const powerLevel = SafeGetValue(data, 'è§’è‰².çŠ¶æ€.æˆ˜åŠ›å±‚çº§', 'ç¬¬ä¸€å±‚çº§/æ™®é€šå±‚çº§');
   const level = SafeGetValue(data, 'è§’è‰².çŠ¶æ€.ç­‰çº§', '1');
    const hp = SafeGetValue(data, 'è§’è‰².èµ„æº.ç”Ÿå‘½å€¼', '0');
    const hpMax = SafeGetValue(data, 'è§’è‰².èµ„æº.ç”Ÿå‘½å€¼ä¸Šé™', '0');
    const mp = SafeGetValue(data, 'è§’è‰².èµ„æº.æ³•åŠ›å€¼', '0');
    const mpMax = SafeGetValue(data, 'è§’è‰².èµ„æº.æ³•åŠ›å€¼ä¸Šé™', '0');
    const sp = SafeGetValue(data, 'è§’è‰².èµ„æº.ä½“åŠ›å€¼', '0');
    const spMax = SafeGetValue(data, 'è§’è‰².èµ„æº.ä½“åŠ›å€¼ä¸Šé™', '0');

    const statusSummaryText = `${powerLevel} | ç­‰çº§: ${level} | HP: ${hp}/${hpMax} | MP: ${mp}/${mpMax} | SP: ${sp}/${spMax}`;
    setElementText('character-status-summary-details', statusSummaryText);
  }

   function setupStaticEventListeners() {
    const lilithShopButton = document.getElementById('lilith-shop-btn');
    if (lilithShopButton && !lilithShopButton.dataset.listenerAttached) {
      lilithShopButton.addEventListener('click', () => {
        const commandToSend = '/send å¼€å§‹å‘½è¿æŠ½å¡*5|/trigger';
        if (typeof triggerSlash === 'function') {
          triggerSlash(commandToSend);
        } else {
          console.error('triggerSlash function is not available.');
        }
      });
      lilithShopButton.dataset.listenerAttached = 'true';
    }

    const updateNewsButton = document.getElementById('update-news-btn');
    if (updateNewsButton && !updateNewsButton.dataset.listenerAttached) {
      updateNewsButton.addEventListener('click', () => {
        const commandToSend = '/send æ›´æ–°"æ¯æ—¥æ–°é—»"|/trigger';
         if (typeof triggerSlash === 'function') {
          triggerSlash(commandToSend);
         } else {
          console.error('triggerSlash function is not available.');
         }
      });
      updateNewsButton.dataset.listenerAttached = 'true';
    }
   }

   async function initDisplay() {
    try {
     const messages = await getChatMessages(getCurrentMessageId());
     if (!messages || messages.length === 0 || !messages[0].data) {
      console.error('æ— æ³•åŠ è½½çŠ¶æ€æ•°æ®: æ¶ˆæ¯ä¸ºç©ºæˆ–ä¸å«æ•°æ®');
      return;
     }
     const characterData = messages[0].data.stat_data;
     if (!characterData) {
      console.error('æ— æ³•åŠ è½½çŠ¶æ€æ•°æ®: stat_data ç¼ºå¤±');
      return;
     }

     updateWorldState(characterData);
     updateAscensionLadder(characterData);
     updateTasks(characterData);
     updateCharacterResources(characterData);
     updateCharacterStatus(characterData);
     updateCharacterAttributes(characterData);
     updateSkills(characterData);
     updateEquipment(characterData);
     updateInventory(characterData);
     updateDestinySystem(characterData);
     updateNews(characterData);
     setupStaticEventListeners();
     updateAllSummaryDetails(characterData);
     setupCollapsibles();

    } catch (error) {
     console.error('çŠ¶æ€æ åŠ è½½å‡ºé”™:', error);
     document.body.innerHTML = `<p style='color:red; padding:20px; text-align:center;'>çŠ¶æ€æ åŠ è½½æ—¶å‡ºç°ä¸¥é‡é”™è¯¯: ${error.message}</p>`;
    }
   }

   document.addEventListener('DOMContentLoaded', initDisplay);

  </script>
 </body>
</html>
